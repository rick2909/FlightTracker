@model FlightTracker.Web.Models.ViewModels.RegisterViewModel
@{
    ViewData["Title"] = "Create Account";
    ViewData["ShowSidebar"] = false;

    var fullNameError = ViewData.ModelState[nameof(@Model.FullName)]?.Errors;
    var userNameError = ViewData.ModelState[nameof(@Model.UserName)]?.Errors;
    var emailError = ViewData.ModelState[nameof(@Model.Email)]?.Errors;
    var passwordError = ViewData.ModelState[nameof(@Model.Password)]?.Errors;
    var confirmPasswordError = ViewData.ModelState[nameof(@Model.ConfirmPassword)]?.Errors;
    var acceptTermsError = ViewData.ModelState[nameof(@Model.AcceptTerms)]?.Errors;
    var hasFullNameError = fullNameError?.Count > 0;
    var hasUserNameError = userNameError?.Count > 0;
    var hasEmailError = emailError?.Count > 0;
    var hasPasswordError = passwordError?.Count > 0;
    var hasConfirmPasswordError = confirmPasswordError?.Count > 0;
    var hasAcceptTermsError = acceptTermsError?.Count > 0;
}

<div class="login-page">
    <div class="login-card">
        <div class="login-card__header">
            <h1 class="login-card__title">Create your account</h1>
            <p class="login-card__subtitle">Join FlightTracker and start logging every journey.</p>
        </div>

        @if (ViewData.ModelState.ContainsKey("RegistrationFailed") && ViewData.ModelState["RegistrationFailed"]?.Errors.Count > 0)
        {
            <div class="login-form__errors" role="alert">
                <span class="material-icons login-form__errors-icon" aria-hidden="true">error</span>
                <div>
                    @foreach (var error in ViewData.ModelState["RegistrationFailed"]!.Errors)
                    {
                        <div>@error.ErrorMessage</div>
                    }
                </div>
            </div>
        }

        <form class="login-form" method="post" asp-controller="Auth" asp-action="Register" novalidate>
            @Html.AntiForgeryToken()
            <div class="login-form__field">
                <label class="login-form__label@(hasFullNameError ? " login-form__label--invalid" : string.Empty)" for="FullName">Full Name</label>
                <input class="login-form__input@(hasFullNameError ? " login-form__input--invalid" : string.Empty)" id="FullName" name="FullName" value="@Model.FullName" autocomplete="name" aria-invalid="@(hasFullNameError ? "true" : "false")" @(hasFullNameError ? "aria-describedby=\"FullName-error\"" : "") />
                @if (hasFullNameError)
                {
                    <div class="login-form__error" id="FullName-error">@fullNameError![0].ErrorMessage</div>
                }
            </div>
            <div class="login-form__field">
                <label class="login-form__label@(hasUserNameError ? " login-form__label--invalid" : string.Empty)" for="UserName">Username</label>
                <input class="login-form__input@(hasUserNameError ? " login-form__input--invalid" : string.Empty)" id="UserName" name="UserName" value="@Model.UserName" autocomplete="username" aria-invalid="@(hasUserNameError ? "true" : "false")" @(hasUserNameError ? "aria-describedby=\"UserName-error\"" : "") />
                @if (hasUserNameError)
                {
                    <div class="login-form__error" id="UserName-error">@userNameError![0].ErrorMessage</div>
                }
            </div>
            <div class="login-form__field">
                <label class="login-form__label@(hasEmailError ? " login-form__label--invalid" : string.Empty)" for="Email">Email</label>
                <input class="login-form__input@(hasEmailError ? " login-form__input--invalid" : string.Empty)" id="Email" name="Email" type="email" value="@Model.Email" autocomplete="email" aria-invalid="@(hasEmailError ? "true" : "false")" @(hasEmailError ? "aria-describedby=\"Email-error\"" : "") />
                @if (hasEmailError)
                {
                    <div class="login-form__error" id="Email-error">@emailError![0].ErrorMessage</div>
                }
            </div>
            <div class="login-form__field">
                <label class="login-form__label@(hasPasswordError ? " login-form__label--invalid" : string.Empty)" for="Password">Password</label>
                <input class="login-form__input@(hasPasswordError ? " login-form__input--invalid" : string.Empty)" id="Password" name="Password" type="password" autocomplete="new-password" aria-invalid="@(hasPasswordError ? "true" : "false")" @(hasPasswordError ? "aria-describedby=\"Password-errors\"" : "") />
                @if (hasPasswordError)
                {
                    <div class="login-form__error" id="Password-errors" role="alert">
                        @for (int i = 0; i < passwordError!.Count; i++)
                        {
                            <div>@passwordError![i].ErrorMessage</div>
                        }
                    </div>
                }
            </div>
            <div class="login-form__field">
                <label class="login-form__label@(hasConfirmPasswordError ? " login-form__label--invalid" : string.Empty)" for="ConfirmPassword">Confirm password</label>
                <input class="login-form__input@(hasConfirmPasswordError ? " login-form__input--invalid" : string.Empty)" id="ConfirmPassword" name="ConfirmPassword" type="password" autocomplete="new-password" aria-invalid="@(hasConfirmPasswordError ? "true" : "false")" @(hasConfirmPasswordError ? "aria-describedby=\"ConfirmPassword-error\"" : "") />
                @if (hasConfirmPasswordError)
                {
                    <div class="login-form__error" id="ConfirmPassword-error">@confirmPasswordError![0].ErrorMessage</div>
                }
            </div>
            <div class="login-form__row">
                <label class="login-form__checkbox@(hasAcceptTermsError ? " login-form__checkbox--invalid" : string.Empty)">
                    <input class="login-form__checkbox-input" type="checkbox" name="AcceptTerms" value="true" @(Model.AcceptTerms ? "checked" : string.Empty) aria-invalid="@(hasAcceptTermsError ? "true" : "false")" @(hasAcceptTermsError ? "aria-describedby=\"AcceptTerms-error\"" : "") />
                    <span class="login-form__checkbox-box" aria-hidden="true"></span>
                    <span class="login-form__checkbox-text">I agree to the Terms and Privacy Policy</span>
                </label>
            </div>
            @if (hasAcceptTermsError)
            {
                <div class="login-form__error" id="AcceptTerms-error">@acceptTermsError![0].ErrorMessage</div>
            }
            <div class="login-form__actions">
                <button class="login-form__button" type="submit">
                    <span class="material-icons" aria-hidden="true">person_add</span>
                    Create account
                </button>
                <a class="login-form__link" href="/login">Already have an account?</a>
            </div>
        </form>

            @if (ViewBag.DevBypassEnabled is true)
            {
                <form method="post" action="/dev-login" class="login-form__dev-login-form">
                    @Html.AntiForgeryToken()
                    <button class="login-form__link login-form__dev-login-button" type="submit">Dev sign in</button>
                </form>
            }
    </div>
</div>
