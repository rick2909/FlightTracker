@model FlightTracker.Web.Models.ViewModels.StatsViewModel
@{
    ViewData["Title"] = "Passport / Stats";
}

@section HeaderContent {
    <div class="remove__header"></div>
}

<partial name="_FlightMap" view-data='new ViewDataDictionary(ViewData) { ["FlightMapHeight"] = "65vh" }' />

<div class="ft-stats-grid" style="margin-top:1rem">
    <div class="ft-stats-grid__item">
        @(await Html.RenderComponentAsync<FlightTracker.Web.Components.Cards.StatCard>(RenderMode.ServerPrerendered, new {
            Title = "Total Flights",
            Data = Model.Stats.TotalFlights.ToString(),
            Icon = "flight",
            SubTitle = "Lifetime"
        }))
    </div>
    <div class="ft-stats-grid__item">
        @(await Html.RenderComponentAsync<FlightTracker.Web.Components.Cards.StatCard>(RenderMode.ServerPrerendered, new {
            Title = "Airports Visited",
            Data = Model.Stats.UniqueAirports.ToString(),
            Icon = "flight_land",
            SubTitle = "Unique"
        }))
    </div>
    <div class="ft-stats-grid__item">
        @(await Html.RenderComponentAsync<FlightTracker.Web.Components.Cards.StatCard>(RenderMode.ServerPrerendered, new {
            Title = "Countries Visited",
            Data = Model.Stats.UniqueCountries.ToString(),
            Icon = "public",
            SubTitle = "Unique"
        }))
    </div>
</div>

<div class="rz-card" style="margin-top:1rem">
    <div class="rz-card-header" style="display:flex;align-items:center;justify-content:space-between">
        <div style="display:flex;align-items:center;gap:.5rem">
            <span class="material-icons" aria-hidden="true">bar_chart</span>
            <h3 style="margin:0">Flights per year</h3>
        </div>
    </div>
    <div class="rz-card-body">
        <div id="apx-flights-per-year" style="min-height:300px"></div>
        <script type="application/json" id="apxFlightsPerYearData">@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.FlightsPerYear))</script>
    </div>
    <div class="rz-card-footer" style="font-size:.8rem;color:#666">Counts based on recorded flights</div>
    </div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="~/js/flight-map.js" asp-append-version="true"></script>
    <script>
        (function(){
            const el=document.getElementById('apxFlightsPerYearData');
            const target=document.getElementById('apx-flights-per-year');
            if(!el||!target||!window.ApexCharts){ return; }
            let data=[]; try{ data=JSON.parse(el.textContent||'[]'); }catch{}
            const years=data.map(p=>p.year);
            const counts=data.map(p=>p.count);
            const options={
                chart:{ type:'bar', height:320, toolbar:{show:false}},
                series:[{ name:'Flights', data:counts}],
                xaxis:{ categories:years, tickPlacement:'on'},
                colors:['#3f51b5'],
                grid:{ borderColor:'#E0E0E0' },
                dataLabels:{ enabled:false },
                tooltip:{ theme:'light' }
            };
            const chart=new ApexCharts(target, options);
            chart.render();
        })();
    </script>
}
