@model YourApp.Models.PassportDetailsViewModel
@using System.Text.Json
@{
    ViewData["Title"] = "Passport Details";
    var jsonOpts = new JsonSerializerOptions { PropertyNamingPolicy = JsonNamingPolicy.CamelCase };
}

<h2>Passport Details for @Model.UserName</h2>

<div class="ft-passport-details-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-top:2rem">
    <div>
        <h3>Airlines Flown</h3>
        <div id="passport-details-airlines-pie" style="min-height:260px"></div>
        <ul>
            @foreach (var stat in Model.AirlineStats)
            {
                <li><strong>@stat.AirlineName</strong> (@stat.Count flights)</li>
            }
        </ul>
    </div>
    <div>
        <h3>Aircraft Types Flown</h3>
        <div id="passport-details-aircraft-pie" style="min-height:260px"></div>
        <ul>
            @foreach (var kvp in Model.AircraftTypeStats)
            {
                <li>
                    <strong>@kvp.Key</strong> (@kvp.Value flights)
                </li>
            }
        </ul>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Flight History (@Model.UserFlights?.Count() flights)</h5>
            </div>
            <div class="card-body">
                @if (Model.UserFlights?.Any() == true)
                {
                    <component type="typeof(FlightTracker.Web.Components.UserFlightsList)"
                                render-mode="ServerPrerendered"
                                param-Flights="Model.UserFlights" />
                }
                else
                {
                    <div class="text-center py-5">
                        <i class="fas fa-plane fa-3x text-muted mb-3"></i>
                        <h4>No flights recorded</h4>
                        <p class="text-muted">Start tracking your aviation journey by adding your first flight!</p>
                        <component type="typeof(FlightTracker.Web.Components.Flights.AddFlightLauncher)"
                                    render-mode="Server" />
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="~/js/passport.js" asp-append-version="true"></script>
    <script>
        (function(){
            var airlines = @Html.Raw(JsonSerializer.Serialize(Model.FlightsByAirline ?? new(), jsonOpts));
            var aircraftTypes = @Html.Raw(JsonSerializer.Serialize(Model.FlightsByAircraftType ?? new(), jsonOpts));
            if (window.Passport) {
                try { window.Passport.initPie && window.Passport.initPie('passport-details-airlines-pie', airlines, 'Airlines'); } catch {}
                try { window.Passport.initPie && window.Passport.initPie('passport-details-aircraft-pie', aircraftTypes, 'Aircraft Types'); } catch {}
            }
        })();
    </script>
}
